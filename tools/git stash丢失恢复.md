
### git stash记录丢失如何找回？

有时候在 git stash 非常有用，但是我们你能由于一些错误的操作，导致将 git stash 中内容被删除掉，误删 stash。


#### 知识点

git fsck 命令用于检查 Git 仓库中的对象的完整性和一致性。它可以发现和报告一些潜在的问题，比如损坏的对象、丢失的对象引用等。

检查对象完整性： 确保所有的对象（提交、文件树、文件等）在物理上存在且没有损坏。如果有对象损坏，git fsck 将报告并显示问题。
寻找不可达对象： Git 使用引用来跟踪对象，如果某个对象没有任何引用指向它（即不可达对象），git fsck 会发现并报告这些不可达的对象。
查找丢失的对象引用： 它会检查是否存在引用（比如分支、标签等），但没有对应的对象存在。这可能是因为删除了对象或引用指向了一个不存在的对象。
输出报告： 将列出发现的问题，并提供相应的修复建议或提示。


**step 1** 查看unreachable 列表

执行命令：

```
git fsck --unreachable
```
将所有的内容复制到一个编辑器中（方便查找），因为这个列表可能很长，在终端展示有限。

#### 认识 unreachable 分类

| 类型 | 描述 |
| --- | :--: |
Commit | 不再有分支或标签指向的提交
Tree | 不再有提交指向的文件树
Blob | 不再有文件树指向的文件对象
Tag | 不再有分支或提交指向的标签
unreachable | 一般表示 Git 对象的一部分，但由于没有引用指向它们，因此被视为不可达

> 这里我们重点关注 commit 对象。

**step 2 查看分类信息**

执行命令：

```
git show <sha>
```

根据返回的信息，判断是不是我们需要恢复的内容，根据个人经验， commit 是我们需要恢复的内容可能比较大。

**step 3 恢复**

有目标的 sha key, 然后切换到 stash 的分支，执行命令：

```
git stash apply <sha>
```

可能会出现如下的错误：

```
fatal: '<sha>' is not a stash-like commit
```

解决办法：使用cherry-pick命令

```
git cherry-pick <sha>
git reset HEAD~1 --soft
```

**step 4 重新暂存**

执行命令：

```
git stash save "stash message"
```

